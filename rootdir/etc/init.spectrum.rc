#
# Device        : Xiaomi Mi 5 (gemini)
# Maintainer    : MOVZX (MOVZX@Telegram.org)
#

# SPECTRUM KERNEL MANAGER
# Ramdisk file for profile based kernel management
# Implimentation inspired by Franco's fku profiles

# Initialization
on property:sys.boot_completed=1
    # Set default profile on first boot
    exec u:r:init:s0 root root -- /init.spectrum.sh
    exec u:r:su:s0 root root -- /init.spectrum.sh
    exec u:r:init:s0 root root -- /vendor/etc/init/hw/init.spectrum.sh
    exec u:r:su:s0 root root -- /vendor/etc/init/hw/init.spectrum.sh
    # Enable Spectrum support
    setprop spectrum.support 1

    setprop persist.spectrum.kernel Darkness

#
# Darkness Modes
#

# Balanced (default profile)
on property:persist.spectrum.profile=0
    # Set CPU Parameters
        # Little
            chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
            chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1363200
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1593600
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 307200
            # SchedUtil
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/schedutil/iowait_boost_enable
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us
                write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor schedutil
                write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 1000
                write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/iowait_boost_enable 0
                write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 250
        # Big
            chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq
            chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/scaling_min_freq
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq 1804800
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq 2342400
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_min_freq 307200
            write /sys/devices/system/cpu/cpu2/online 1
            # SchedUtil
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/schedutil/down_rate_limit_us
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/schedutil/iowait_boost_enable
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/schedutil/up_rate_limit_us
                write /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor schedutil
                write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/down_rate_limit_us 1000
                write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/iowait_boost_enable 0
                write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/up_rate_limit_us 250
    #
    # CPU Scheduler
        write /dev/stune/schedtune.boost 0
    #
    # CPU Input Boost
        write /sys/module/cpu_boost/parameters/input_boost_freq "0:1113600 1:0 2:1190400 3:0"
        write /sys/module/cpu_boost/parameters/input_boost_ms 1000
    #
    # Dynamic SchedTune Boost
        write /sys/module/cpu_boost/parameters/dynamic_stune_boost_rt 30
        write /sys/module/cpu_boost/parameters/dynamic_stune_boost_top_app 10
    #
    # Set Adreno GPU
        write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 510000000
        write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 652800000
        write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq 133000000
    #
    # Set I/O Scheduler
        # SDA
            write /sys/block/sda/queue/nr_requests 1024
            write /sys/block/sda/queue/read_ahead_kb 1024
        # SDB
            write /sys/block/sdb/queue/nr_requests 1024
            write /sys/block/sdb/queue/read_ahead_kb 1024
        # SDC
            write /sys/block/sdc/queue/nr_requests 1024
            write /sys/block/sdc/queue/read_ahead_kb 1024
        # SDD
            write /sys/block/sdd/queue/nr_requests 1024
            write /sys/block/sdd/queue/read_ahead_kb 1024
        # SDE
            write /sys/block/sde/queue/nr_requests 1024
            write /sys/block/sde/queue/read_ahead_kb 1024
        # SDF
            write /sys/block/sdf/queue/nr_requests 1024
            write /sys/block/sdf/queue/read_ahead_kb 1024
        # DM-0
            write /sys/block/dm-0/queue/nr_requests 1024
            write /sys/block/dm-0/queue/read_ahead_kb 1024
    #
    # UFS Tweaks
        write /sys/devices/soc/624000.ufshc/624000.ufshc:ufs_variant/pm_qos_enable 1
        write /sys/devices/soc/624000.ufshc/clkgate_enable 1
        write /sys/devices/soc/624000.ufshc/clkscale_enable 1
        write /sys/module/scsi_mod/parameters/use_blk_mq Y
    #
    # Entropy Tweaks
        write /proc/sys/kernel/random/read_wakeup_threshold 512
        write /proc/sys/kernel/random/write_wakeup_threshold 256
    #
    # Misc Tweaks
        write /sys/module/workqueue/parameters/power_efficient Y

# Performance
on property:persist.spectrum.profile=1
    # Set CPU Parameters
        # Little
            chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
            chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1363200
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1593600
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 307200
            # SchedUtil
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/schedutil/iowait_boost_enable
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us
                write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor schedutil
                write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 2000
                write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/iowait_boost_enable 1
                write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 100
        # Big
            chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq
            chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/scaling_min_freq
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq 1804800
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq 2342400
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_min_freq 307200
            write /sys/devices/system/cpu/cpu2/online 1
            # SchedUtil
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/schedutil/down_rate_limit_us
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/schedutil/iowait_boost_enable
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/schedutil/up_rate_limit_us
                write /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor schedutil
                write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/down_rate_limit_us 2000
                write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/iowait_boost_enable 1
                write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/up_rate_limit_us 100
    #
    # CPU Scheduler
        write /dev/stune/schedtune.boost 1
    #
    # CPU Input Boost
        write /sys/module/cpu_boost/parameters/input_boost_freq "0:1113600 1:0 2:1190400 3:0"
        write /sys/module/cpu_boost/parameters/input_boost_ms 2000
    #
    # Dynamic SchedTune Boost
        write /sys/module/cpu_boost/parameters/dynamic_stune_boost_rt 50
        write /sys/module/cpu_boost/parameters/dynamic_stune_boost_top_app 30
    #
    # Set Adreno GPU
        write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 510000000
        write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 652800000
        write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq 214000000
    #
    # Set I/O Scheduler
        # SDA
            write /sys/block/sda/queue/nr_requests 1024
            write /sys/block/sda/queue/read_ahead_kb 1024
        # SDB
            write /sys/block/sdb/queue/nr_requests 1024
            write /sys/block/sdb/queue/read_ahead_kb 1024
        # SDC
            write /sys/block/sdc/queue/nr_requests 1024
            write /sys/block/sdc/queue/read_ahead_kb 1024
        # SDD
            write /sys/block/sdd/queue/nr_requests 1024
            write /sys/block/sdd/queue/read_ahead_kb 1024
        # SDE
            write /sys/block/sde/queue/nr_requests 1024
            write /sys/block/sde/queue/read_ahead_kb 1024
        # SDF
            write /sys/block/sdf/queue/nr_requests 1024
            write /sys/block/sdf/queue/read_ahead_kb 1024
        # DM-0
            write /sys/block/dm-0/queue/nr_requests 1024
            write /sys/block/dm-0/queue/read_ahead_kb 1024
    #
    # UFS Tweaks
        write /sys/devices/soc/624000.ufshc/624000.ufshc:ufs_variant/pm_qos_enable 0
        write /sys/devices/soc/624000.ufshc/clkgate_enable 0
        write /sys/devices/soc/624000.ufshc/clkscale_enable 0
        write /sys/module/scsi_mod/parameters/use_blk_mq Y
    #
    # Entropy Tweaks
        write /proc/sys/kernel/random/read_wakeup_threshold 1024
        write /proc/sys/kernel/random/write_wakeup_threshold 512
    #
    # Misc Tweaks
        write /sys/module/workqueue/parameters/power_efficient N

# Battery
on property:persist.spectrum.profile=2
    # Set CPU Parameters
        # Little
            chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
            chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1190400
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 307200
            write /sys/devices/system/cpu/cpu0/online 1
            # DarkEnergy
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/darkenergy/down_rate_limit_us
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/darkenergy/up_rate_limit_us
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
                write /sys/devices/system/cpu/cpu0/cpufreq/darkenergy/down_rate_limit_us 1000
                write /sys/devices/system/cpu/cpu0/cpufreq/darkenergy/up_rate_limit_us 250
                write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor darkenergy
        # Big
            chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq
            chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/scaling_min_freq
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq 1632000
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_min_freq 307200
            write /sys/devices/system/cpu/cpu2/online 1
            # DarkEnergy
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/darkenergy/down_rate_limit_us
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/darkenergy/up_rate_limit_us
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor
                write /sys/devices/system/cpu/cpu2/cpufreq/darkenergy/down_rate_limit_us 1000
                write /sys/devices/system/cpu/cpu2/cpufreq/darkenergy/up_rate_limit_us 250
                write /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor darkenergy
    #
    # CPU Scheduler
        write /dev/stune/schedtune.boost 0
    #
    # CPU Input Boost
        write /sys/module/cpu_boost/parameters/input_boost_freq "0:0 1:0 2:0 3:0"
        write /sys/module/cpu_boost/parameters/input_boost_ms 0
    #
    # Dynamic SchedTune Boost
        write /sys/module/cpu_boost/parameters/dynamic_stune_boost_rt 15
        write /sys/module/cpu_boost/parameters/dynamic_stune_boost_top_app 5
    #
    # Set Adreno GPU
        write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 401800000
        write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq 133000000
    #
    # Set I/O Scheduler
        # SDA
            write /sys/block/sda/queue/nr_requests 128
            write /sys/block/sda/queue/read_ahead_kb 128
        # SDB
            write /sys/block/sdb/queue/nr_requests 128
            write /sys/block/sdb/queue/read_ahead_kb 128
        # SDC
            write /sys/block/sdc/queue/nr_requests 128
            write /sys/block/sdc/queue/read_ahead_kb 128
        # SDD
            write /sys/block/sdd/queue/nr_requests 128
            write /sys/block/sdd/queue/read_ahead_kb 128
        # SDE
            write /sys/block/sde/queue/nr_requests 128
            write /sys/block/sde/queue/read_ahead_kb 128
        # SDF
            write /sys/block/sdf/queue/nr_requests 128
            write /sys/block/sdf/queue/read_ahead_kb 128
        # DM-0
            write /sys/block/dm-0/queue/nr_requests 128
            write /sys/block/dm-0/queue/read_ahead_kb 128
    #
    # UFS Tweaks
        write /sys/devices/soc/624000.ufshc/624000.ufshc:ufs_variant/pm_qos_enable 1
        write /sys/devices/soc/624000.ufshc/clkgate_enable 1
        write /sys/devices/soc/624000.ufshc/clkscale_enable 1
        write /sys/module/scsi_mod/parameters/use_blk_mq N
    #
    # Entropy Tweaks
        write /proc/sys/kernel/random/read_wakeup_threshold 128
        write /proc/sys/kernel/random/write_wakeup_threshold 64
    #
    # Misc Tweaks
        write /sys/module/workqueue/parameters/power_efficient Y

# Gaming
on property:persist.spectrum.profile=3
    # Set CPU Parameters
        # Little
            chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
            chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1363200
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1593600
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 307200
            # SchedUtil
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/schedutil/iowait_boost_enable
                chmod 777 /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us
                write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor schedutil
                write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 3000
                write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/iowait_boost_enable 1
                write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 100
        # Big
            chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq
            chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/scaling_min_freq
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq 1804800
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq 2342400
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_min_freq 307200
            write /sys/devices/system/cpu/cpu2/online 1
            # SchedUtil
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/schedutil/down_rate_limit_us
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/schedutil/iowait_boost_enable
                chmod 777 /sys/devices/system/cpu/cpu2/cpufreq/schedutil/up_rate_limit_us
                write /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor schedutil
                write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/down_rate_limit_us 3000
                write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/iowait_boost_enable 1
                write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/up_rate_limit_us 100
    #
    # CPU Scheduler
        write /dev/stune/schedtune.boost 1
    #
    # CPU Input Boost
        write /sys/module/cpu_boost/parameters/input_boost_freq "0:1113600 1:0 2:1190400 3:0"
        write /sys/module/cpu_boost/parameters/input_boost_ms 3000
    #
    # Dynamic SchedTune Boost
        write /sys/module/cpu_boost/parameters/dynamic_stune_boost_rt 80
        write /sys/module/cpu_boost/parameters/dynamic_stune_boost_top_app 50
    #
    # Set Adreno GPU
        write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 510000000
        write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 652800000
        write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq 315000000
    #
    # Set I/O Scheduler
        # SDA
            write /sys/block/sda/queue/nr_requests 2048
            write /sys/block/sda/queue/read_ahead_kb 2048
        # SDB
            write /sys/block/sdb/queue/nr_requests 2048
            write /sys/block/sdb/queue/read_ahead_kb 2048
        # SDC
            write /sys/block/sdc/queue/nr_requests 2048
            write /sys/block/sdc/queue/read_ahead_kb 2048
        # SDD
            write /sys/block/sdd/queue/nr_requests 2048
            write /sys/block/sdd/queue/read_ahead_kb 2048
        # SDE
            write /sys/block/sde/queue/nr_requests 2048
            write /sys/block/sde/queue/read_ahead_kb 2048
        # SDF
            write /sys/block/sdf/queue/nr_requests 2048
            write /sys/block/sdf/queue/read_ahead_kb 2048
        # DM-0
            write /sys/block/dm-0/queue/nr_requests 2048
            write /sys/block/dm-0/queue/read_ahead_kb 2048
    #
    # UFS Tweaks
        write /sys/devices/soc/624000.ufshc/624000.ufshc:ufs_variant/pm_qos_enable 0
        write /sys/devices/soc/624000.ufshc/clkgate_enable 0
        write /sys/devices/soc/624000.ufshc/clkscale_enable 0
        write /sys/module/scsi_mod/parameters/use_blk_mq Y
    #
    # Entropy Tweaks
        write /proc/sys/kernel/random/read_wakeup_threshold 2048
        write /proc/sys/kernel/random/write_wakeup_threshold 1024
    #
    # Misc Tweaks
        write /sys/module/workqueue/parameters/power_efficient N
